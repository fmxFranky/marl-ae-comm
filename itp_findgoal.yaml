description: MARL JOB
target:
  service: amlk8s
  # run "amlt target list amlk8s" to list the names of available AMLK8s targets
  # run "amlt target info" to list the names of available AMLK8s targets
  name: itpscusv100cl #itpscusv100cl # #itpscusv100cl #itpeusp40cl #itpseasiav100cl #itpscusv100cl #
  vc: resrchvc

environment:
  image: mxfeng/deep_rl:marl_comm
  registry: docker.io # any public registry can be specified here
  setup:
    - pip install -e ./marl-grid/env
    - pip install gym==0.23.0
    - wandb login 31ce01e4120061694da54a54ab0dafbee1262420

code:
  # local directory of the code. this will be uploaded to the server.
  # $CONFIG_DIR is expanded to the directory of this config file
  local_dir: $CONFIG_DIR

search:
  job_template:
    name: marlcomm_{auto:s}
    sku: G4
    aml_mpirun:
      process_count_per_node: 0
    command:
      - python ./marl-grid/find-goal/train.py gpu=[0,1,2,3]
        num_workers=16 env_cfg.comm_len=10 seed={seed} algo=ae-comm
        use_wandb=true wandb_project_name=marl-ae-comm2 mlm_encoded={mlm_encoded}
    submit_args:
      env:
        AMLT_NO_TENSORBOARD_PATCHING: true
      container_args:
        shm_size: 64g
  type: grid
  max_trials: 16
  params:
    - name: mlm_encoded
      spec: discrete
      values: [true, false]
    - name: seed
      spec: discrete
      values: [1, 2, 3, 4, 5]
    